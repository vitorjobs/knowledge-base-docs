<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>main.tf - Instância EC2 com acesso via SSM (Sem SSH) | Documentação Geral</title>
    <meta name="description" content="Estudos Diversos em Tecnologia">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style.CF0zJ56n.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CvWNKUV8.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Be2-VvxL.js">
    <link rel="modulepreload" href="/assets/chunks/framework.D70b1pOo.js">
    <link rel="modulepreload" href="/assets/terraform_EC2_Instância EC2 com acesso via SSM (Sem SSH).md.B8ffILUc.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle has-sidebar" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>Documentação Geral</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--]--><div class="VPNavBarSearch search" data-v-70946a35><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Início</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/markdown-examples.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Docs</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>Appearance</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-db738f89><span class="vpi-align-left menu-icon" data-v-db738f89></span><span class="menu-text" data-v-db738f89>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1df9f90f data-v-af661f50><div class="curtain" data-v-af661f50></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-af661f50><span class="visually-hidden" id="sidebar-aria-label" data-v-af661f50> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>Ansible</h2><!----></div><div class="items" data-v-d81de50c><!--[--><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-d81de50c data-v-d81de50c><div class="item" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/Ansible/index.html" rel="noopener noreferrer" data-v-d81de50c><!--[--><h3 class="text" data-v-d81de50c>Projetos e Exemplos</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d81de50c><span class="vpi-chevron-right caret-icon" data-v-d81de50c></span></div></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/Ansible/Projects/MonitoringWithDockerComposer/README.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Stack de Monitoramento</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/Ansible/comandos.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Comandos Ansible</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>AWS</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/aws/index.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Configuração CLI AWS</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>Terraform</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/terraform/index.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Instalação Terraform</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/terraform/EC2/index.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Lançar Instância EC2</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-sidebar has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>On this page</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _terraform_EC2_Inst%C3%A2ncia%20EC2%20com%20acesso%20via%20SSM%20(Sem%20SSH)" data-v-7011f0d8><div><h1 id="main-tf-instancia-ec2-com-acesso-via-ssm-sem-ssh" tabindex="-1">main.tf - Instância EC2 com acesso via SSM (Sem SSH) <a class="header-anchor" href="#main-tf-instancia-ec2-com-acesso-via-ssm-sem-ssh" aria-label="Permalink to “main.tf - Instância EC2 com acesso via SSM (Sem SSH)”">​</a></h1><h1 id="" tabindex="-1">----------------------------- <a class="header-anchor" href="#" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="instrucoes-de-uso" tabindex="-1">Instruções de Uso <a class="header-anchor" href="#instrucoes-de-uso" aria-label="Permalink to “Instruções de Uso”">​</a></h1><h1 id="-1" tabindex="-1">----------------------------- <a class="header-anchor" href="#-1" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="para-conectar-a-instancia-via-ssm" tabindex="-1">Para conectar à instância via SSM: <a class="header-anchor" href="#para-conectar-a-instancia-via-ssm" aria-label="Permalink to “Para conectar à instância via SSM:”">​</a></h1><h1 id="_1-configure-o-aws-cli-com-o-mesmo-profile-do-terraform" tabindex="-1">1. Configure o AWS CLI com o mesmo profile do Terraform: <a class="header-anchor" href="#_1-configure-o-aws-cli-com-o-mesmo-profile-do-terraform" aria-label="Permalink to “1. Configure o AWS CLI com o mesmo profile do Terraform:”">​</a></h1><h1 id="aws-configure-profile-bia-tf" tabindex="-1">aws configure --profile bia-tf <a class="header-anchor" href="#aws-configure-profile-bia-tf" aria-label="Permalink to “aws configure --profile bia-tf”">​</a></h1><h1 id="-2" tabindex="-1"><a class="header-anchor" href="#-2" aria-label="Permalink to “”">​</a></h1><h1 id="_2-conecte-usando-o-comando" tabindex="-1">2. Conecte usando o comando: <a class="header-anchor" href="#_2-conecte-usando-o-comando" aria-label="Permalink to “2. Conecte usando o comando:”">​</a></h1><h1 aws_instance.bia_dev_ssm.id="" id="aws-ssm-start-session-target" tabindex="-1">aws ssm start-session --target $ <a class="header-anchor" href="#aws-ssm-start-session-target" aria-label="Permalink to “aws ssm start-session --target $”">​</a></h1><h1 id="-3" tabindex="-1"><a class="header-anchor" href="#-3" aria-label="Permalink to “”">​</a></h1><h1 id="_3-alternativamente-use-o-console-aws" tabindex="-1">3. Alternativamente, use o Console AWS: <a class="header-anchor" href="#_3-alternativamente-use-o-console-aws" aria-label="Permalink to “3. Alternativamente, use o Console AWS:”">​</a></h1><h1 id="aws-console-systems-manager-session-manager-start-session" tabindex="-1">AWS Console &gt; Systems Manager &gt; Session Manager &gt; Start Session <a class="header-anchor" href="#aws-console-systems-manager-session-manager-start-session" aria-label="Permalink to “AWS Console &gt; Systems Manager &gt; Session Manager &gt; Start Session”">​</a></h1><h1 id="-4" tabindex="-1"><a class="header-anchor" href="#-4" aria-label="Permalink to “”">​</a></h1><h1 id="_4-para-ver-os-logs-das-sessoes" tabindex="-1">4. Para ver os logs das sessões: <a class="header-anchor" href="#_4-para-ver-os-logs-das-sessoes" aria-label="Permalink to “4. Para ver os logs das sessões:”">​</a></h1><h1 id="aws-console-cloudwatch-log-groups-aws-ssm-sessions-bia-instance" tabindex="-1">AWS Console &gt; CloudWatch &gt; Log groups &gt; /aws/ssm/sessions/bia-instance <a class="header-anchor" href="#aws-console-cloudwatch-log-groups-aws-ssm-sessions-bia-instance" aria-label="Permalink to “AWS Console &gt; CloudWatch &gt; Log groups &gt; /aws/ssm/sessions/bia-instance”">​</a></h1><h1 id="notas-importantes" tabindex="-1">Notas importantes: <a class="header-anchor" href="#notas-importantes" aria-label="Permalink to “Notas importantes:”">​</a></h1><h1 id="nenhuma-porta-ssh-22-esta-aberta" tabindex="-1">- Nenhuma porta SSH (22) está aberta <a class="header-anchor" href="#nenhuma-porta-ssh-22-esta-aberta" aria-label="Permalink to “- Nenhuma porta SSH (22) está aberta”">​</a></h1><h1 id="acesso-seguro-via-iam-permissions" tabindex="-1">- Acesso seguro via IAM permissions <a class="header-anchor" href="#acesso-seguro-via-iam-permissions" aria-label="Permalink to “- Acesso seguro via IAM permissions”">​</a></h1><h1 id="todas-as-sessoes-sao-logadas-no-cloudwatch" tabindex="-1">- Todas as sessões são logadas no CloudWatch <a class="header-anchor" href="#todas-as-sessoes-sao-logadas-no-cloudwatch" aria-label="Permalink to “- Todas as sessões são logadas no CloudWatch”">​</a></h1><h1 id="funciona-mesmo-em-subnets-privadas" tabindex="-1">- Funciona mesmo em subnets privadas <a class="header-anchor" href="#funciona-mesmo-em-subnets-privadas" aria-label="Permalink to “- Funciona mesmo em subnets privadas”">​</a></h1><h1 id="main-tf-instancia-ec2-com-acesso-apenas-via-ssm-configuracao-minima" tabindex="-1">main.tf - Instância EC2 com acesso apenas via SSM (configuração mínima) <a class="header-anchor" href="#main-tf-instancia-ec2-com-acesso-apenas-via-ssm-configuracao-minima" aria-label="Permalink to “main.tf - Instância EC2 com acesso apenas via SSM (configuração mínima)”">​</a></h1><p>terraform { required_version = &quot;&gt;= 1.5.0&quot;</p><p>required_providers { aws = { source = &quot;hashicorp/aws&quot; version = &quot;~&gt; 5.0&quot; } } }</p><p>provider &quot;aws&quot; { region = &quot;us-east-1&quot; profile = &quot;bia-tf&quot; }</p><h1 id="-5" tabindex="-1">----------------------------- <a class="header-anchor" href="#-5" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="_1-ami-mais-recente-do-amazon-linux-2" tabindex="-1">1. AMI mais recente do Amazon Linux 2 <a class="header-anchor" href="#_1-ami-mais-recente-do-amazon-linux-2" aria-label="Permalink to “1. AMI mais recente do Amazon Linux 2”">​</a></h1><h1 id="-6" tabindex="-1">----------------------------- <a class="header-anchor" href="#-6" aria-label="Permalink to “-----------------------------”">​</a></h1><p>data &quot;aws_ami&quot; &quot;amazon_linux&quot; { most_recent = true owners = [&quot;amazon&quot;]</p><p>filter { name = &quot;name&quot; values = [&quot;amzn2-ami-hvm-*-x86_64-gp2&quot;] } }</p><h1 id="-7" tabindex="-1">----------------------------- <a class="header-anchor" href="#-7" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="_2-iam-role-para-ssm" tabindex="-1">2. IAM Role para SSM <a class="header-anchor" href="#_2-iam-role-para-ssm" aria-label="Permalink to “2. IAM Role para SSM”">​</a></h1><h1 id="-8" tabindex="-1">----------------------------- <a class="header-anchor" href="#-8" aria-label="Permalink to “-----------------------------”">​</a></h1><p>resource &quot;aws_iam_role&quot; &quot;ec2_role&quot; { name = &quot;bia-ec2-role&quot;</p><p>assume_role_policy = jsonencode({ Version = &quot;2012-10-17&quot; Statement = [{ Effect = &quot;Allow&quot; Principal = { Service = &quot;ec2.amazonaws.com&quot; } Action = &quot;sts:AssumeRole&quot; }] }) }</p><h1 id="politica-minima-para-ssm-funcionar" tabindex="-1">Política mínima para SSM funcionar <a class="header-anchor" href="#politica-minima-para-ssm-funcionar" aria-label="Permalink to “Política mínima para SSM funcionar”">​</a></h1><p>resource &quot;aws_iam_role_policy_attachment&quot; &quot;ssm_core&quot; { role = aws_iam_role.ec2_role.name policy_arn = &quot;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&quot; }</p><p>resource &quot;aws_iam_instance_profile&quot; &quot;ec2_profile&quot; { name = &quot;bia-ec2-profile&quot; role = aws_iam_role.ec2_role.name }</p><h1 id="-9" tabindex="-1"># ----------------------------- <a class="header-anchor" href="#-9" aria-label="Permalink to “# -----------------------------”">​</a></h1><h1 id="_3-security-group-apenas-egress" tabindex="-1"># 3. Security Group (apenas egress) <a class="header-anchor" href="#_3-security-group-apenas-egress" aria-label="Permalink to “# 3. Security Group (apenas egress)”">​</a></h1><h1 id="-10" tabindex="-1"># ----------------------------- <a class="header-anchor" href="#-10" aria-label="Permalink to “# -----------------------------”">​</a></h1><h1 id="resource-aws-security-group-allow-outbound" tabindex="-1">resource &quot;aws_security_group&quot; &quot;allow_outbound&quot; { <a class="header-anchor" href="#resource-aws-security-group-allow-outbound" aria-label="Permalink to “resource &quot;aws_security_group&quot; &quot;allow_outbound&quot; {”">​</a></h1><h1 id="name-bia-allow-outbound" tabindex="-1">name = &quot;bia-allow-outbound&quot; <a class="header-anchor" href="#name-bia-allow-outbound" aria-label="Permalink to “name        = &quot;bia-allow-outbound&quot;”">​</a></h1><h1 id="description-allow-outbound-traffic-only" tabindex="-1">description = &quot;Allow outbound traffic only&quot; <a class="header-anchor" href="#description-allow-outbound-traffic-only" aria-label="Permalink to “description = &quot;Allow outbound traffic only&quot;”">​</a></h1><h1 id="⚠️-nenhuma-regra-ingress-acesso-apenas-via-ssm" tabindex="-1"># ⚠️ Nenhuma regra ingress - acesso apenas via SSM <a class="header-anchor" href="#⚠️-nenhuma-regra-ingress-acesso-apenas-via-ssm" aria-label="Permalink to “# ⚠️ Nenhuma regra ingress - acesso apenas via SSM”">​</a></h1><h1 id="egress" tabindex="-1">egress { <a class="header-anchor" href="#egress" aria-label="Permalink to “egress {”">​</a></h1><h1 id="from-port-0" tabindex="-1">from_port = 0 <a class="header-anchor" href="#from-port-0" aria-label="Permalink to “from_port   = 0”">​</a></h1><h1 id="to-port-0" tabindex="-1">to_port = 0 <a class="header-anchor" href="#to-port-0" aria-label="Permalink to “to_port     = 0”">​</a></h1><h1 id="protocol-1" tabindex="-1">protocol = &quot;-1&quot; <a class="header-anchor" href="#protocol-1" aria-label="Permalink to “protocol    = &quot;-1&quot;”">​</a></h1><h1 id="cidr-blocks-0-0-0-0-0" tabindex="-1">cidr_blocks = [&quot;0.0.0.0/0&quot;] <a class="header-anchor" href="#cidr-blocks-0-0-0-0-0" aria-label="Permalink to “cidr_blocks = [&quot;0.0.0.0/0&quot;]”">​</a></h1><h1 id="-11" tabindex="-1">} <a class="header-anchor" href="#-11" aria-label="Permalink to “}”">​</a></h1><h1 id="-12" tabindex="-1">} <a class="header-anchor" href="#-12" aria-label="Permalink to “}”">​</a></h1><h1 id="-13" tabindex="-1">----------------------------- <a class="header-anchor" href="#-13" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="_3-security-group-porta-3001-ssm" tabindex="-1">3. Security Group (Porta 3001 + SSM) <a class="header-anchor" href="#_3-security-group-porta-3001-ssm" aria-label="Permalink to “3. Security Group (Porta 3001 + SSM)”">​</a></h1><h1 id="-14" tabindex="-1">----------------------------- <a class="header-anchor" href="#-14" aria-label="Permalink to “-----------------------------”">​</a></h1><p>resource &quot;aws_security_group&quot; &quot;bia_app_sg&quot; { name = &quot;bia-app-security-group&quot; description = &quot;Allow port 3001 for app and SSM access&quot;</p><h1 id="regra-para-sua-aplicacao-porta-3001" tabindex="-1">Regra para sua aplicação (porta 3001) <a class="header-anchor" href="#regra-para-sua-aplicacao-porta-3001" aria-label="Permalink to “Regra para sua aplicação (porta 3001)”">​</a></h1><p>ingress { description = &quot;Allow HTTP on port 3001&quot; from_port = 3001 to_port = 3001 protocol = &quot;tcp&quot; cidr_blocks = [&quot;0.0.0.0/0&quot;] }</p><h1 id="permite-todo-trafego-de-saida" tabindex="-1">Permite todo tráfego de saída <a class="header-anchor" href="#permite-todo-trafego-de-saida" aria-label="Permalink to “Permite todo tráfego de saída”">​</a></h1><p>egress { from_port = 0 to_port = 0 protocol = &quot;-1&quot; cidr_blocks = [&quot;0.0.0.0/0&quot;] }</p><p>tags = { Name = &quot;bia-app-sg&quot; } }</p><h1 id="-15" tabindex="-1">----------------------------- <a class="header-anchor" href="#-15" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="_4-ec2-instance" tabindex="-1">4. EC2 Instance <a class="header-anchor" href="#_4-ec2-instance" aria-label="Permalink to “4. EC2 Instance”">​</a></h1><h1 id="-16" tabindex="-1">----------------------------- <a class="header-anchor" href="#-16" aria-label="Permalink to “-----------------------------”">​</a></h1><p>resource &quot;aws_instance&quot; &quot;bia_dev&quot; { ami = data.aws_ami.amazon_linux.id instance_type = &quot;t3.micro&quot;</p><h1 id="associa-o-profile-iam-com-permissoes-ssm" tabindex="-1">Associa o profile IAM com permissões SSM <a class="header-anchor" href="#associa-o-profile-iam-com-permissoes-ssm" aria-label="Permalink to “Associa o profile IAM com permissões SSM”">​</a></h1><p>iam_instance_profile = aws_iam_instance_profile.ec2_profile.name</p><h1 id="security-group-que-permite-apenas-saida" tabindex="-1">Security Group que permite apenas saída <a class="header-anchor" href="#security-group-que-permite-apenas-saida" aria-label="Permalink to “Security Group que permite apenas saída”">​</a></h1><p>vpc_security_group_ids = [aws_security_group.bia_app_sg.id]</p><h1 id="user-data-a-partir-de-arquivo-externo" tabindex="-1">User data a partir de arquivo externo <a class="header-anchor" href="#user-data-a-partir-de-arquivo-externo" aria-label="Permalink to “User data a partir de arquivo externo”">​</a></h1><p>user_data = file(&quot;userdata.sh&quot;)</p><p>tags = { Name = &quot;bia-ssm-instance&quot; } }</p><h1 id="-17" tabindex="-1">----------------------------- <a class="header-anchor" href="#-17" aria-label="Permalink to “-----------------------------”">​</a></h1><h1 id="_5-output-essencial" tabindex="-1">5. Output essencial <a class="header-anchor" href="#_5-output-essencial" aria-label="Permalink to “5. Output essencial”">​</a></h1><h1 id="-18" tabindex="-1">----------------------------- <a class="header-anchor" href="#-18" aria-label="Permalink to “-----------------------------”">​</a></h1><p>output &quot;instance_id&quot; { value = aws_instance.bia_dev.id }</p><p>output &quot;connect_command&quot; { value = &quot;aws ssm start-session --target ${aws_instance.bia_dev.id}&quot; }</p></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/Ansible/index.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Próxima Página</span><span class="title" data-v-e257564d>Projetos e Exemplos</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ansible_comandos.md\":\"BPJGuNMS\",\"ansible_index.md\":\"BRk8ovWK\",\"ansible_instalacao.md\":\"DYStZxH1\",\"ansible_modulos.md\":\"BnPjgisF\",\"ansible_playbook.md\":\"C6JX9x8w\",\"ansible_projects_monitoringwithdockercomposer_readme.md\":\"DGd7cPdb\",\"ansible_roles.md\":\"DkUKMo1E\",\"api-examples.md\":\"BVQkKuEM\",\"aws_cli_configuracao_profile_iam.md\":\"Ddn7OK2S\",\"aws_index.md\":\"B1sL0uqo\",\"index.md\":\"BpmguDCg\",\"markdown-examples.md\":\"InernQbK\",\"terraform_ec2_index.md\":\"D_az70e0\",\"terraform_ec2_instância ec2 com acesso via ssm (sem ssh).md\":\"B8ffILUc\",\"terraform_iam_create-users.md\":\"NR9DcBkF\",\"terraform_iam_index.md\":\"QWU35-Qe\",\"terraform_index.md\":\"BHGdEapA\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Documentação Geral\",\"description\":\"Estudos Diversos em Tecnologia\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Início\",\"link\":\"/\"},{\"text\":\"Docs\",\"link\":\"/markdown-examples\"}],\"sidebar\":[{\"text\":\"Ansible\",\"items\":[{\"collapsed\":true,\"rel\":\"noopener noreferrer\",\"text\":\"Projetos e Exemplos\",\"link\":\"/Ansible/index.md\",\"items\":[{\"text\":\"Stack de Monitoramento\",\"link\":\"/Ansible/Projects/MonitoringWithDockerComposer/README.md\"}]},{\"text\":\"Comandos Ansible\",\"link\":\"/Ansible/comandos.md\"}]},{\"text\":\"AWS\",\"items\":[{\"text\":\"Configuração CLI AWS\",\"link\":\"/aws/index\"}]},{\"text\":\"Terraform\",\"items\":[{\"text\":\"Instalação Terraform\",\"link\":\"/terraform/index\"},{\"text\":\"Lançar Instância EC2\",\"link\":\"/terraform/EC2/index\"}]}],\"docFooter\":{\"prev\":\"Página Anterior\",\"next\":\"Próxima Página\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>